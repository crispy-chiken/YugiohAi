Select t.rowid, t.Name, t.ParentId, t.ChildId, t.ACtionID, t.HistoryId, t.Reward, t.Visited, t.IsFirst, t.IsTraining, t.Reward/t.visited, a.name, a.action from MCST as t, (Select Name, ParentId, MAX(Visited) as v From MCST group by ParentId order by v desc) as m, L_ActionList as a where t.ParentId == m.ParentId and m.v > 1 and t.parentId <> -4 and t.actionId = a.rowid order by v desc, t.parentId